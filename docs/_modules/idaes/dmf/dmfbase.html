

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>idaes.dmf.dmfbase &mdash; IDAES v1.0.0</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/idaes-logo.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/theme_and_schema.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> IDAES
          

          
            
            <img src="../../../_static/idaes-logo-100x100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../standards.html">IDAES Modeling Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core/index.html">Core Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models/index.html">Unit Model Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../property_models/index.html">Property Model Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dmf/index.html">Data Management Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../version.html">IDAES versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IDAES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>idaes.dmf.dmfbase</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for idaes.dmf.dmfbase</h1><div class="highlight"><pre>
<span></span><span class="c1">##############################################################################</span>
<span class="c1"># Institute for the Design of Advanced Energy Systems Process Systems</span>
<span class="c1"># Engineering Framework (IDAES PSE Framework) Copyright (c) 2018-2019, by the</span>
<span class="c1"># software owners: The Regents of the University of California, through</span>
<span class="c1"># Lawrence Berkeley National Laboratory,  National Technology &amp; Engineering</span>
<span class="c1"># Solutions of Sandia, LLC, Carnegie Mellon University, West Virginia</span>
<span class="c1"># University Research Corporation, et al. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Please see the files COPYRIGHT.txt and LICENSE.txt for full copyright and</span>
<span class="c1"># license information, respectively. Both files are also available online</span>
<span class="c1"># at the URL &quot;https://github.com/IDAES/idaes-pse&quot;.</span>
<span class="c1">##############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Data Management Framework</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># stdlib</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="c1"># third-party</span>
<span class="kn">import</span> <span class="nn">pendulum</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">observe</span>
<span class="kn">from</span> <span class="nn">traitlets</span> <span class="k">import</span> <span class="n">Unicode</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="c1"># local</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">errors</span><span class="p">,</span> <span class="n">workspace</span><span class="p">,</span> <span class="n">resourcedb</span><span class="p">,</span> <span class="n">propdata</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">resource</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">mkdir_p</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Dan Gunter &lt;dkgunter@lbl.gov&gt;&#39;</span>

<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="DMFConfig"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMFConfig">[docs]</a><span class="k">class</span> <span class="nc">DMFConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Global DMF configuration.</span>

<span class="sd">    Every time you create an instance of the :class:`DMF`</span>
<span class="sd">    or run a ``dmf`` command on the command-line, the library opens the</span>
<span class="sd">    global DMF configuration file to figure out the default workspace</span>
<span class="sd">    (and, eventually, other values).</span>

<span class="sd">    The default location for this configuration file is &quot;~/.dmf&quot;, i.e.</span>
<span class="sd">    the file named &quot;.dmf&quot; in the user&#39;s home directory. This can be</span>
<span class="sd">    modified programmatically by changing the &quot;filename&quot; attribute of</span>
<span class="sd">    this class.</span>

<span class="sd">    The contents of the configuration are formatted as `YAML`_ with</span>
<span class="sd">    the following keys defined:</span>

<span class="sd">        workspace</span>
<span class="sd">            Path to the default workspace directory.</span>

<span class="sd">    .. _YAML: http://www.yaml.org/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># configuration file location</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.dmf&#39;</span><span class="p">)</span>
    <span class="c1"># known keys</span>
    <span class="n">WORKSPACE</span> <span class="o">=</span> <span class="s1">&#39;workspace&#39;</span>
    <span class="n">_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">WORKSPACE</span><span class="p">]</span>
    <span class="c1"># defaults</span>
    <span class="n">DEFAULTS</span> <span class="o">=</span> <span class="p">{</span><span class="n">WORKSPACE</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            defaults (dict): Default values to use if nothing is found.</span>
<span class="sd">                            If not provided, use self.DEFAULTS</span>
<span class="sd">        Raises:</span>
<span class="sd">            IOError: If self.filename is not openable or readable</span>
<span class="sd">            ValueError: If the file can&#39;t be parsed as YAML</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># init to defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULTS</span><span class="p">)</span>
        <span class="c1"># try to open the config file</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File not found: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Unable to open global DMF configuration file &#39;</span>
                       <span class="s1">&#39;for reading: </span><span class="si">{}</span><span class="s1">. Using default configuration values.&#39;</span>
                       <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="c1"># if we got a config file, parse it</span>
        <span class="k">if</span> <span class="n">fp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parsing configuration at &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                 <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

<div class="viewcode-block" id="DMFConfig.save"><a class="viewcode-back" href="../../../apidoc/idaes.dmf.dmfbase.html#idaes.dmf.dmfbase.DMFConfig.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">workspace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">WORKSPACE</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span></div>


<div class="viewcode-block" id="DMF"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF">[docs]</a><span class="k">class</span> <span class="nc">DMF</span><span class="p">(</span><span class="n">workspace</span><span class="o">.</span><span class="n">Workspace</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data Management Framework (DMF).</span>

<span class="sd">    Expected usage is to instantiate this class, once, and then use it for</span>
<span class="sd">    storing, searching, and retrieving resources that</span>
<span class="sd">    are required for the given analysis.</span>

<span class="sd">    For details on the configuration files used by the DMF, see</span>
<span class="sd">    documentation for :class:`DMFConfig` (global configuration) and</span>
<span class="sd">    :class:`idaes.dmf.workspace.Workspace`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_file</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Database file name&#39;</span><span class="p">)</span>
    <span class="n">datafile_dir</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;Data file directory, &#39;</span>
                                <span class="s1">&#39;relative to DMF root&#39;</span><span class="p">)</span>

    <span class="n">CONF_DB_FILE</span> <span class="o">=</span> <span class="s1">&#39;db_file&#39;</span>
    <span class="n">CONF_DATA_DIR</span> <span class="o">=</span> <span class="s1">&#39;datafile_dir&#39;</span>
    <span class="n">CONF_HELP_PATH</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">Fields</span><span class="o">.</span><span class="n">DOC_HTML_PATH</span>

    <span class="c1"># logging should really provide this</span>
    <span class="n">_levelnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fatal&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">FATAL</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
                   <span class="s1">&#39;warn&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span>
                   <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">ws_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create or load DMF workspace.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to workspace. If given, will override any</span>
<span class="sd">                  global configuration. If not given (empty or None), then</span>
<span class="sd">                  global configuration will be checked first. If empty, and</span>
<span class="sd">                  the global configuration does not parse or exist, then</span>
<span class="sd">                  &quot;.&quot; will be used.</span>
<span class="sd">            name (str): Name to be used for workspace.</span>
<span class="sd">            desc (str): Longer description of workspace.</span>
<span class="sd">            create (bool): If the path to the workspace does not exist,</span>
<span class="sd">                           this controls whether to create it or raise</span>
<span class="sd">                           an error.</span>
<span class="sd">            **ws_kwargs: Keyword arguments for :meth:`workspace.Workspace()`</span>
<span class="sd">                         constructor.</span>
<span class="sd">        Raises:</span>
<span class="sd">            WorkspaceError: Any error that could be raised by the Workspace</span>
<span class="sd">                            superclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get global configuration</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">DMFConfig</span><span class="p">(</span><span class="n">defaults</span><span class="o">=</span><span class="p">{})</span>
        <span class="c1"># get path, if not specified, from configuration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DMFConfig</span><span class="o">.</span><span class="n">WORKSPACE</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="c1"># set up workspace</span>
        <span class="n">ws_kwargs</span><span class="p">[</span><span class="s1">&#39;create&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">DMF</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">ws_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Configuration &quot;</span><span class="si">{}</span><span class="s1">&quot;, parse error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">WorkspaceError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># check local config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_conf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
        <span class="c1"># merge selected global config values into local</span>
        <span class="c1"># XXX: not done</span>
        <span class="c1"># set up logging</span>
        <span class="k">if</span> <span class="n">workspace</span><span class="o">.</span><span class="n">Fields</span><span class="o">.</span><span class="n">LOG_CONF</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_configure_logging</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Configuration &quot;</span><span class="si">{}</span><span class="s1">&quot;, logging section error: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">path</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">WorkspaceError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># set up rest of DMF</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">resourcedb</span><span class="o">.</span><span class="n">ResourceDB</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datafile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafile_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datafile_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datafile_path</span><span class="p">,</span> <span class="mo">0o750</span><span class="p">)</span>
        <span class="c1"># add create/modified date, and optional name/description</span>
        <span class="n">_w</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">Workspace</span>
        <span class="n">right_now</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">to_datetime_string</span><span class="p">()</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="n">_w</span><span class="o">.</span><span class="n">CONF_CREATED</span><span class="p">:</span> <span class="n">right_now</span><span class="p">,</span> <span class="n">_w</span><span class="o">.</span><span class="n">CONF_MODIFIED</span><span class="p">:</span> <span class="n">right_now</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">_w</span><span class="o">.</span><span class="n">CONF_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">_w</span><span class="o">.</span><span class="n">CONF_DESC</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_meta</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_configure_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure logging for DMF.</span>

<span class="sd">        Expected schema::</span>

<span class="sd">            &lt;logger-name&gt;:</span>
<span class="sd">                level: &lt;levelname&gt;              default=NOTSET</span>
<span class="sd">                output: file|_stdout_|_stderr_  default=_stderr_</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: for bad configuration values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">workspace</span><span class="o">.</span><span class="n">Fields</span><span class="o">.</span><span class="n">LOG_CONF</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lognm</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">lognm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_logger</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_logger</span><span class="p">(</span><span class="n">lognm</span><span class="p">)</span>
            <span class="n">subconf</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="n">lognm</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;output&#39;</span> <span class="ow">in</span> <span class="n">subconf</span><span class="p">:</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">subconf</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dest</span> <span class="o">==</span> <span class="s1">&#39;_stdout_&#39;</span><span class="p">:</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dest</span> <span class="o">==</span> <span class="s1">&#39;_stderr_&#39;</span><span class="p">:</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">h</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot open output file &quot;</span><span class="si">{}</span><span class="s1">&quot; for &#39;</span>
                                         <span class="s1">&#39;logger &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">lognm</span><span class="p">))</span>
                <span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;level&#39;</span> <span class="ow">in</span> <span class="n">subconf</span><span class="p">:</span>
                <span class="n">levelnm</span> <span class="o">=</span> <span class="n">subconf</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_levelnames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">levelnm</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">opt</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_levelnames</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Bad level &quot;</span><span class="si">{}</span><span class="s1">&quot; for logger &quot;</span><span class="si">{}</span><span class="s1">&quot;. Must be &#39;</span>
                                     <span class="s1">&#39;one of: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">levelnm</span><span class="p">,</span> <span class="n">lognm</span><span class="p">,</span> <span class="n">opt</span><span class="p">))</span>
                <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;format&#39;</span> <span class="ow">in</span> <span class="n">subconf</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">subconf</span><span class="p">[</span><span class="s1">&#39;format&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">log</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
                        <span class="n">h</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_logger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a logger by absolute or short-hand name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="s1">&#39;idaes&#39;</span>
        <span class="c1"># idaes.&lt;whatever&gt; just use name as-is</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;idaes\.[a-zA-Z_.]+&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># .&lt;whatever&gt;, root at idaes</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.[a-zA-Z_.]+&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="s1">&#39;idaes&#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="c1"># some special names</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dmf&#39;</span><span class="p">,</span> <span class="s1">&#39;core&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;ui&#39;</span><span class="p">):</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="s1">&#39;idaes.&#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="c1"># when in doubt just take value as-is</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_conf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONF_HELP_PATH</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Path to built HTML documentation is not set. &#39;</span>
                         <span class="s1">&#39;The DMF &quot;help&quot; command will not work. To set &#39;</span>
                         <span class="s1">&#39;this path, set &quot;</span><span class="si">{}</span><span class="s1">&quot; in the DMF configuration file.&#39;</span>
                         <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_HELP_PATH</span><span class="p">))</span>

    <span class="nd">@default</span><span class="p">(</span><span class="n">CONF_DB_FILE</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_default_db_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DB_FILE</span><span class="p">,</span> <span class="s1">&#39;resourcedb.json&#39;</span><span class="p">)</span>

    <span class="nd">@default</span><span class="p">(</span><span class="n">CONF_DATA_DIR</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_default_res_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONF_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;files&#39;</span><span class="p">)</span>

    <span class="nd">@observe</span><span class="p">(</span><span class="n">CONF_DB_FILE</span><span class="p">,</span> <span class="n">CONF_DATA_DIR</span><span class="p">,</span> <span class="n">CONF_HELP_PATH</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_observe_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;change&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">change</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_meta</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

<div class="viewcode-block" id="DMF.add"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsrc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a resource and associated files.</span>

<span class="sd">        If the resource has &#39;datafiles&#39;, there are some special</span>
<span class="sd">        values that cause those files to be copied and possibly the</span>
<span class="sd">        original removed at this point. There are attributes `do_copy`</span>
<span class="sd">        and `is_tmp` on the resource, and also potentially keys of the</span>
<span class="sd">        same name in the datafiles themselves. If present, the datafile</span>
<span class="sd">        key/value pairs will override the attributes in the resource.</span>
<span class="sd">        For `do_copy`, the original file will be copied into the</span>
<span class="sd">        DMF workspace. If `do_copy` is True, then if `is_tmp` is also</span>
<span class="sd">        True the original file will be removed (after the copy is made,</span>
<span class="sd">        of course).</span>

<span class="sd">        Args:</span>
<span class="sd">            rsrc (resource.Resource): The resource</span>
<span class="sd">        Returns:</span>
<span class="sd">            (str) Resource ID</span>
<span class="sd">        Raises:</span>
<span class="sd">            DMFError, DuplicateResourceError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Copy files as necessary</span>
        <span class="c1"># Note: this updates paths in the Resource, so should come first</span>
        <span class="k">if</span> <span class="s1">&#39;datafiles&#39;</span> <span class="ow">in</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files</span><span class="p">(</span><span class="n">rsrc</span><span class="p">)</span>
        <span class="c1"># Add resource</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">rsrc</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">DuplicateResourceError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Cannot add resource: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">id</span></div>

    <span class="k">def</span> <span class="nf">_copy_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsrc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;datafiles_dir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># If there is a datafiles_dir, use it</span>
            <span class="n">ddir</span> <span class="o">=</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;datafiles_dir&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no datafiles_dir, create a random subdir of the DMF</span>
            <span class="c1"># configured `_datafile_path`. The subdir prevents name</span>
            <span class="c1"># collisions across resources.</span>
            <span class="n">random_subdir</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
            <span class="n">ddir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datafile_path</span><span class="p">,</span> <span class="n">random_subdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mkdir_p</span><span class="p">(</span><span class="n">ddir</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DMFError</span><span class="p">(</span><span class="s1">&#39;Cannot make dir &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ddir</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">datafile</span> <span class="ow">in</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;datafiles&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;do_copy&#39;</span> <span class="ow">in</span> <span class="n">datafile</span><span class="p">:</span>
                <span class="n">do_copy</span> <span class="o">=</span> <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;do_copy&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do_copy</span> <span class="o">=</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">do_copy</span>
            <span class="k">if</span> <span class="n">do_copy</span><span class="p">:</span>
                <span class="c1"># The `do_copy` flag says do a copy of this datafile from its</span>
                <span class="c1"># current path, say /a/path/to/file, into the resource&#39;s</span>
                <span class="c1"># datafile-dir, say /a/dir/for/resources/, resulting in</span>
                <span class="c1"># e.g. /a/dir/for/resources/file.</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
                <span class="n">filedir</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                <span class="n">copydir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ddir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Copying datafile &quot;</span><span class="si">{}</span><span class="s1">&quot; to directory &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">copydir</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">copydir</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot copy datafile from &quot;</span><span class="si">{}</span><span class="s1">&quot; to DMF &#39;</span> \
                          <span class="s1">&#39;directory &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">copydir</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DMFError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># The `is_tmp` flag means to remove the original resource file</span>
                <span class="c1"># after the copy is done.</span>
                <span class="k">if</span> <span class="s1">&#39;is_tmp&#39;</span> <span class="ow">in</span> <span class="n">datafile</span><span class="p">:</span>
                    <span class="n">is_tmp</span> <span class="o">=</span> <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;is_tmp&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_tmp</span> <span class="o">=</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">is_tmp</span>
                <span class="k">if</span> <span class="n">is_tmp</span><span class="p">:</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Temporary datafile flag is on, removing &#39;</span>
                               <span class="s1">&#39;original datafile &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Removing temporary datafile &quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;is_tmp&#39;</span> <span class="ow">in</span> <span class="n">datafile</span><span class="p">:</span>  <span class="c1"># remove this directive</span>
                        <span class="k">del</span> <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;is_tmp&#39;</span><span class="p">]</span>
                <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;is_copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="s1">&#39;do_copy&#39;</span> <span class="ow">in</span> <span class="n">datafile</span><span class="p">:</span>  <span class="c1"># remove this directive</span>
                    <span class="k">del</span> <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;do_copy&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datafile</span><span class="p">[</span><span class="s1">&#39;is_copy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># For idempotence, turn off these flags post-copy</span>
        <span class="n">rsrc</span><span class="o">.</span><span class="n">do_copy</span> <span class="o">=</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">is_tmp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Make sure datafiles dir is in sync</span>
        <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;datafiles_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddir</span>

<div class="viewcode-block" id="DMF.count"><a class="viewcode-back" href="../../../apidoc/idaes.dmf.dmfbase.html#idaes.dmf.dmfbase.DMF.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span></div>

<div class="viewcode-block" id="DMF.fetch_one"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.fetch_one">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">id_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch one resource, from its identifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            rid (str): Resource identifier</span>
<span class="sd">            id_only (bool): If true, return only the identifier of each</span>
<span class="sd">                resource; otherwise a Resource object is returned.</span>
<span class="sd">        Returns:</span>
<span class="sd">            (resource.Resource) The found resource, or None if no match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="o">.</span><span class="n">ID_FIELD</span><span class="p">:</span> <span class="n">rid</span><span class="p">},</span>
                                 <span class="n">id_only</span><span class="o">=</span><span class="n">id_only</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">id_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postproc_resource</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="DMF.find"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">id_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find and return resources matching the filter.</span>

<span class="sd">        The filter syntax is a subset of the MongoDB filter syntax.</span>
<span class="sd">        This means that it is represented as a dictionary, where</span>
<span class="sd">        each key is an attribute or nested attribute name, and each</span>
<span class="sd">        value is the value against which to match. There are five</span>
<span class="sd">        possible types of values:</span>

<span class="sd">        1. scalar string or number (int, float): Match resources that</span>
<span class="sd">           have this exact value for the given attribute.</span>
<span class="sd">        2. date, as datetime.datetime or pendulum.Pendulum instance: Match</span>
<span class="sd">           resources that have this exact date for the given attribute.</span>
<span class="sd">        3. list: Match resources that have a list value for this attribute,</span>
<span class="sd">           and for which any of the values in the provided list are in the</span>
<span class="sd">           resource&#39;s corresponding value. If a &#39;!&#39; is appended to the key</span>
<span class="sd">           name, then this will be interpreted as a directive to only match</span>
<span class="sd">           resources for which *all* values in the provided list are present.</span>
<span class="sd">        4. dict: This is an inequality, with one or more key/value pairs.</span>
<span class="sd">           The key is the type of inequality and the value is the numeric</span>
<span class="sd">           value for that range. All keys begin with &#39;$&#39;. The possible</span>
<span class="sd">           inequalities are:</span>

<span class="sd">                - &quot;$lt&quot;: Less than (&lt;)</span>
<span class="sd">                - &quot;$le&quot;: Less than or equal (&lt;=)</span>
<span class="sd">                - &quot;$gt&quot;: Greater than (&gt;)</span>
<span class="sd">                - &quot;$ge&quot;: Greater than or equal (&gt;=)</span>
<span class="sd">                - &quot;$ne&quot;: Not equal to (!=)</span>

<span class="sd">        5. Boolean True means does the field exist, and False means</span>
<span class="sd">           does it *not* exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            filter_dict (dict): Search filter.</span>
<span class="sd">            id_only (bool): If true, return only the identifier of each</span>
<span class="sd">                resource; otherwise a Resource object is returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list of int|Resource) Depending on the value of `id_only`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_postproc_resource</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span> <span class="n">id_only</span><span class="o">=</span><span class="n">id_only</span><span class="p">))</span></div>

<div class="viewcode-block" id="DMF.find_related"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.find_related">[docs]</a>    <span class="k">def</span> <span class="nf">find_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsrc</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxdepth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">outgoing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find related resources.</span>

<span class="sd">        Args:</span>
<span class="sd">            rsrc (resource.Resource): Resource starting point</span>
<span class="sd">            filter_dict (dict): See parameter of same name in :meth:`find`.</span>
<span class="sd">            maxdepth (int): Maximum depth of search (starts at 1)</span>
<span class="sd">            meta (List[str]): Metadata fields to extract for meta part</span>
<span class="sd">            outgoing (bool): If True, look at outgoing relations. Otherwise</span>
<span class="sd">                             look at incoming relations. e.g. if A &#39;uses&#39; B</span>
<span class="sd">                             and if True, would find B starting from A.</span>
<span class="sd">                             If False, would find A starting from B.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Generates  triples (depth, Triple, meta), where</span>
<span class="sd">            the depth is an integer (starting at 1), the Triple is a</span>
<span class="sd">            simple namedtuple wrapping (subject, object, predicate), and</span>
<span class="sd">            `meta` is a dict of metadata for the endpoint of the relation</span>
<span class="sd">            (the object if outgoing=True, the subject if outgoing=False)</span>
<span class="sd">            for the fields provided in the `meta` parameter.</span>
<span class="sd">        Raises:</span>
<span class="sd">            NoSuchResourceError: if the starting resource is not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">find_related</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">outgoing</span><span class="o">=</span><span class="n">outgoing</span><span class="p">,</span>
                                         <span class="n">maxdepth</span><span class="o">=</span><span class="n">maxdepth</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">NoSuchResourceError</span><span class="p">(</span><span class="n">id_</span><span class="o">=</span><span class="n">rsrc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="DMF.remove"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_relations</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove one or more resources, from its identifier or a filter.</span>
<span class="sd">        Unless told otherwise, this method will scan the DB and remove</span>
<span class="sd">        all relations that involve this resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            identifier (str): Identifier for a resource.</span>
<span class="sd">            filter_dict (dict): Filter to use instead of identifier</span>
<span class="sd">            update_relations (bool): If True (the default), scan the DB and</span>
<span class="sd">                remove all relations that involve this identifier.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">((</span><span class="n">identifier</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">id_list</span><span class="p">,</span> <span class="n">rid_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">identifier</span><span class="p">:</span>
            <span class="n">id_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_one</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">id_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">id_one</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">id_one</span><span class="p">]</span>
            <span class="n">rid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">id_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">filter_dict</span><span class="o">=</span><span class="n">filter_dict</span><span class="p">,</span> <span class="n">id_only</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">id_list</span><span class="p">:</span>
                <span class="n">rid_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
                    <span class="n">rsrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">rid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">id_list</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cannot remove resource-id=</span><span class="si">{}</span><span class="s1"> filter=</span><span class="si">{}</span><span class="s1">: Not found&#39;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">filter_dict</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">idlist</span><span class="o">=</span><span class="n">id_list</span><span class="p">,</span> <span class="n">internal_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># If requested, remove deleted resources from all the relations</span>
        <span class="c1"># where it was a subject or object</span>
        <span class="k">if</span> <span class="n">update_relations</span><span class="p">:</span>
            <span class="c1"># look at all resources in DB</span>
            <span class="k">for</span> <span class="n">rsrc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
                <span class="c1"># for each one figure out which relations to keep</span>
                <span class="n">keep</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]:</span>
                    <span class="c1"># if none of the removed resource ids are present, keep it</span>
                    <span class="k">if</span> <span class="n">rel</span><span class="p">[</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rid_list</span><span class="p">:</span>
                        <span class="n">keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span>
                <span class="c1"># if we didn&#39;t keep all the relations, update the resource</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]):</span>
                    <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
                    <span class="c1"># save back to DMF</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rsrc</span><span class="p">)</span></div>

<div class="viewcode-block" id="DMF.update"><a class="viewcode-back" href="../../../dmf/base.html#idaes.dmf.dmfbase.DMF.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rsrc</span><span class="p">,</span> <span class="n">sync_relations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">upsert</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update/insert stored resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            rsrc (resource.Resource): Resource instance</span>
<span class="sd">            sync_relations (bool): If True, and if resource</span>
<span class="sd">                exists in the DB, then the &quot;relations&quot; attribute of</span>
<span class="sd">                the provided resource will be changed to the stored value.</span>
<span class="sd">            upsert (bool): If true, and the resource is not in the DMF,</span>
<span class="sd">                           then insert it. If false, and the resource is</span>
<span class="sd">                           not in the DMF, then do nothing.</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the resource was updated or added, False if nothing</span>
<span class="sd">                  was done.</span>
<span class="sd">        Raises:</span>
<span class="sd">            errors.DMFError: If the input resource was invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">did_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># sanity-check input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rsrc</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Resource type expected, got: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">rsrc</span><span class="p">)))</span>
        <span class="c1"># synchronize relations</span>
        <span class="k">if</span> <span class="n">sync_relations</span><span class="p">:</span>
            <span class="n">db_rsrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_one</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">db_rsrc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># print(&#39;@@ updating relations ({}) to ({})&#39;</span>
                <span class="c1">#       .format(rsrc.v[&#39;relations&#39;], db_rsrc.v[&#39;relations&#39;]))</span>
                <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;relations&#39;</span><span class="p">]</span>
        <span class="c1"># update or insert new values</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">rsrc</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">upsert</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">rsrc</span><span class="p">)</span>
                <span class="n">did_update</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">DMFError</span><span class="p">(</span><span class="s1">&#39;Bad value for new resource: </span><span class="si">{}</span><span class="s1">&#39;</span>
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">did_update</span></div>

    <span class="k">def</span> <span class="nf">_postproc_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform any additional changes to resources retrieved</span>
<span class="sd">        before passing them up to the application.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;DMF config=&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_conf</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_propertydb_table"><a class="viewcode-back" href="../../../apidoc/idaes.dmf.dmfbase.html#idaes.dmf.dmfbase.get_propertydb_table">[docs]</a><span class="k">def</span> <span class="nf">get_propertydb_table</span><span class="p">(</span><span class="n">rsrc</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">propdata</span><span class="o">.</span><span class="n">PropertyTable</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rsrc</span><span class="o">.</span><span class="n">datafiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fullpath</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, David Miller et al.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>